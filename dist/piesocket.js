var PieSocket;(()=>{var t={13:(t,e,n)=>{"use strict";n.d(e,{default:()=>h});class s{constructor(t){this.options=t}log(...t){this.options.consoleLogs&&console.log(...t)}warn(...t){this.options.consoleLogs&&console.warn(...t)}error(...t){this.options.consoleLogs&&console.error(...t)}}class o{constructor(t,e,n=!0){this.events={},n&&this.init(t,e)}init(t,e){this.endpoint=t,this.identity=e,this.connection=this.connect(),this.shouldReconnect=!1,this.logger=new s(e)}connect(){var t=new WebSocket(this.endpoint);return t.onmessage=this.onMessage.bind(this),t.onopen=this.onOpen.bind(this),t.onerror=this.onError.bind(this),t.onclose=this.onClose.bind(this),t}on(t,e){this.events[t]=e}send(t){return this.connection.send(t)}onMessage(t){this.logger.log("Channel message:",t);try{var e=JSON.parse(t.data);e.error&&e.error.length&&(this.shouldReconnect=!1)}catch(t){console.error(t)}this.events.message&&this.events.message.bind(this)(t)}onOpen(t){this.logger.log("Channel connected:",t),this.shouldReconnect=!0,this.events.open&&this.events.open.bind(this)(t)}onError(t){this.logger.error("Channel error:",t),this.connection.close(),this.events.error&&this.events.error.bind(this)(t)}onClose(t){this.logger.warn("Channel closed:",t),this.reconnect(),this.events.close&&this.events.close.bind(this)(t)}reconnect(){this.shouldReconnect&&(this.logger.log("Reconnecting"),this.connect())}}class i{constructor(t,e="InvalidAuthException"){this.message="Auth endpoint did not return a valid JWT Token, please see: https://www.piesocket.com/docs/3.0/authentication",this.name=e}}const r={version:3,clusterId:"demo",apiKey:"oCdCMcMPQpbvNjUIzqtvF1d2X2okWpDQj4AwARJuAgtjhzKxVEjQU6IdCjwm",consoleLogs:!1,notifySelf:0,jwt:null,presence:0,authEndpoint:"/broadcasting/auth",authHeaders:{},forceAuth:!1};class h{constructor(t){t=t||{},this.options={...r,...t},this.connections={},this.logger=new s(this.options)}subscribe(t){var e=this.getEndpoint(t);if(this.connections[t])return this.logger.log("Returning existing channel",t),this.connections[t];this.logger.log("Creating new channel",t);var n=new o(null,null,!1);return e.then((e=>{n.init(e,{channelId:t,...this.options})})),this.connections[t]=n,n}unsubscribe(t){return!!this.connections[t]&&(this.connections[t].shouldReconnect=!1,this.connections[t].connection.close(),delete this.connections[t],!0)}getConnections(){return this.connections}async getAuthToken(t){return new Promise(((e,n)=>{var s=new FormData;s.append("channel_name",t);var o=new XMLHttpRequest;o.withCredentials=!0,o.addEventListener("readystatechange",(function(){if(4===this.readyState)try{const t=JSON.parse(this.responseText);e(t.auth)}catch(t){n(new i("Could not fetch auth token","AuthEndpointResponseError"))}})),o.addEventListener("error",(()=>{n(new i("Could not fetch auth token","AuthEndpointError"))})),o.open("POST",this.options.authEndpoint),Object.keys(this.options.authHeaders).forEach((t=>{o.setRequestHeader(t,this.options.authHeaders[t])})),o.send(s)}))}isGuarded(t){return!!this.options.forceAuth||(""+t).startsWith("private-")}async getEndpoint(t){let e=`wss://${this.options.clusterId}.piesocket.com/v${this.options.version}/${t}?api_key=${this.options.apiKey}&notify_self=${this.options.notifySelf}&source=jssdk&v=1.2.1&presence=${this.options.presence}`;return this.options.jwt?e=e+"&jwt="+this.options.jwt:this.isGuarded(t)&&(e=e+"&jwt="+await this.getAuthToken(t)),e}}},138:(t,e,n)=>{t.exports=n(13).default}},e={};function n(s){var o=e[s];if(void 0!==o)return o.exports;var i=e[s]={exports:{}};return t[s](i,i.exports,n),i.exports}n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var s=n(138);PieSocket=s})();